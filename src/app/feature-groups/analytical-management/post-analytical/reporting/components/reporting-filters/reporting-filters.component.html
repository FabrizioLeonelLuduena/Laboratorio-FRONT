<div class="reporting-filters top-[var(--navbar-height,64px)] z-[2] bg-[var(--surface)] border-b border-[var(--border-color)] px-6 py-4 shadow-[0_2px_4px_rgba(0,0,0,0.05)]">
  <div class="flex items-end gap-4 max-w-[1400px] mx-auto">
    <div class="flex flex-col gap-1">
      <label for="dateFrom" class="text-xs font-semibold text-[var(--on-surface)] m-0">Desde</label>
      <p-datepicker
        id="dateFrom"
        [(ngModel)]="dateFrom"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        placeholder="dd/mm/aaaa"
        class="w-full"
        [maxDate]="dateTo">
      </p-datepicker>
    </div>

    <div class="flex flex-col gap-1">
      <label for="dateTo" class="text-xs font-semibold text-[var(--on-surface)] m-0">Hasta</label>
      <p-datepicker
        id="dateTo"
        [(ngModel)]="dateTo"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        placeholder="dd/mm/aaaa"
        class="w-full"
        [minDate]="dateFrom">
      </p-datepicker>
    </div>

    <div class="flex items-end">
      <!-- Botón del filtro personalizado -->
      <button
        #filterButton
        (click)="popover.toggle($event)"
        class="flex items-center justify-center w-10 h-10 border border-[var(--border-color)] rounded-md bg-[var(--card)] text-[var(--brand-primary-700)] hover:bg-[var(--surface-hover)] transition-colors relative">
        <i class="pi pi-filter"></i>
        @if (hasActiveFilters()) {
          <span class="absolute -top-1 -right-1 w-5 h-5 bg-[var(--brand-primary)] text-white text-xs rounded-full flex items-center justify-center">
            {{ activeFiltersCount() }}
          </span>
        }
      </button>

      <p-popover #popover>
        <ng-template pTemplate="content">
          <div class="p-4 min-w-[300px]">
            <!-- Título -->
            <div class="mb-4">
              <h3 class="text-base font-semibold text-[var(--on-surface)] m-0">Filtros</h3>
            </div>

            <div class="border-t border-[var(--border-color)] my-3"></div>

            <!-- Edad Mínima -->
            <div class="mb-4">
              <label for="minAge" class="text-sm font-medium text-[var(--on-surface)] block mb-2">Edad Mínima</label>
              <input
                pInputText
                id="minAge"
                type="number"
                [(ngModel)]="minAge"
                (ngModelChange)="onFilterInputChange()"
                placeholder="Ej: 18"
                min="0"
                max="120"
                class="w-full" />
            </div>

            <!-- Edad Máxima -->
            <div class="mb-4">
              <label for="maxAge" class="text-sm font-medium text-[var(--on-surface)] block mb-2">Edad Máxima</label>
              <input
                pInputText
                id="maxAge"
                type="number"
                [(ngModel)]="maxAge"
                (ngModelChange)="onFilterInputChange()"
                placeholder="Ej: 65"
                min="0"
                max="120"
                class="w-full" />
            </div>

            <div class="border-t border-[var(--border-color)] my-3"></div>

            <!-- Género -->
            <div class="mb-4">
              <label for="gender" class="text-sm font-medium text-[var(--on-surface)] block mb-2">Género</label>
              <p-select
                id="gender"
                [(ngModel)]="gender"
                (onChange)="onFilterInputChange()"
                [options]="genderOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Seleccionar género"
                styleClass="w-full"
                [style]="{'width': '100%'}">
              </p-select>
            </div>

            <div class="border-t border-[var(--border-color)] my-3"></div>


            <!-- Valor de Resultado (Screening) -->
            <div class="mb-4">
              <label for="resultValue" class="text-sm font-medium text-[var(--on-surface)] block mb-2">Resultado</label>
              <p-select
                id="resultValue"
                [(ngModel)]="resultValue"
                (onChange)="onFilterInputChange()"
                [options]="resultValueOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Todos los resultados"
                styleClass="w-full"
                [style]="{'width': '100%'}">
              </p-select>
              <small class="text-xs text-[var(--on-surface-muted)] mt-1 block">Para reportes de screening</small>
            </div>

            <div class="border-t border-[var(--border-color)] my-3"></div>

            <!-- Botones -->
            <div class="flex gap-2">
              <button
                (click)="clearFilters(); popover.hide()"
                class="flex-1 px-3 py-2 text-sm border border-[var(--border-color)] rounded-md bg-[var(--card)] text-[var(--on-surface)] hover:bg-[var(--surface-hover)] transition-colors flex items-center justify-center gap-2">
                <i class="pi pi-refresh text-xs"></i>
                Limpiar
              </button>
            </div>
          </div>
        </ng-template>
      </p-popover>
    </div>
  </div>
</div>

