<app-generic-modal-form
  title="Muestrario"
  [width]="'450px'"
  (closed)="onClose()">

  @if (cart.length === 0) {
    <div class="empty-cart-container">
      <i class="pi pi-inbox text-3xl mb-2 block text-gray-400"></i>
      <p class="text-sm">Registro vac√≠o</p>
    </div>
  } @else {
    <!-- Summary info -->
    @if (incompleteProtocolsCount > 0) {
      <div class="mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800">
        <i class="pi pi-exclamation-triangle mr-1"></i>
        <span>{{ incompleteProtocolsCount }} protocolo(s) incompleto(s)</span>
      </div>
    }
    <!-- Scrollable list with fixed height -->
    <p class="text-sm mb-1">Protocolos</p>
    <div class="border border-gray-200 rounded text-xs overflow-y-auto" style="max-height: 60vh;">
      @for (cartItem of cart; track cartItem.protocol) {
        <div class="flex items-center justify-between p-2 border-b border-gray-100 hover:bg-gray-50">
          <div class="flex items-center gap-2">
            <span class="font-semibold text-sm">{{ cartItem.protocol }}</span>
            <span class="text-xs text-gray-600 bg-gray-100 px-2 py-0.5 rounded" [ngClass]="getStatusClass(cartItem)">
              {{ cartItem.selectedIds.length }}/{{ cartItem.requiredCount }}
            </span>
            <!-- Status badge -->
            <span
              class="text-xs px-2 py-0.5 rounded"
              [ngClass]="getStatusClass(cartItem)"
            >
              {{ getStatusDisplay(cartItem) }}
            </span>

            <!-- Current status indicator -->
            <span class="text-xs text-gray-500">
              ({{ cartItem.currentStatus | translateStatus}})
            </span>
          </div>
          <button
            pButton
            type="button"
            severity="secondary"
            icon="pi pi-trash"
            class="p-button-text p-button-sm !p-0 !w-6 !h-6"
            (click)="onRemoveProtocol(cartItem.protocol); $event.stopPropagation()"
          ></button>
        </div>
      }
    </div>

    <!-- Footer -->
    <div class="mt-3 pt-3 border-t border-gray-200">
      <!-- Summary stats -->
      <div class="mb-3 text-sm space-y-1">
        <div class="flex justify-between">
          <span class="text-gray-600">Total protocolos:</span>
          <span class="font-semibold">{{ cart.length }}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Total rotulos:</span>
          <span class="font-semibold">{{ cartLabelsCount }}</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Completos:</span>
          <span class="font-semibold text-green-600">{{ completeProtocolsCount }}</span>
        </div>
        @if (incompleteProtocolsCount > 0) {
          <div class="flex justify-between">
            <span class="text-gray-600">Incompletos:</span>
            <span class="font-semibold text-yellow-600">{{ incompleteProtocolsCount }}</span>
          </div>
        }
      </div>

      <div class="flex justify-end gap-3">
        <app-generic-button
          text="Vaciar"
          type="alternative"
          [disabled]="loading"
          (pressed)="onClearCart()"
        ></app-generic-button>

        <app-generic-button
          text="Registrar"
          type="create"
          [disabled]="!allProtocolsComplete || loading"
          (click)="onRegister()"
        />
      </div>

    </div>
  }
</app-generic-modal-form>
