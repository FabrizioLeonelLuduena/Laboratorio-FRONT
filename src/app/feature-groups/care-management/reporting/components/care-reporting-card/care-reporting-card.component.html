<p-card class="flex flex-col">
  <div class="flex items-start justify-between gap-3 pb-3 border-b border-[var(--border-color)] mb-3">
    <div class="flex items-start gap-2 flex-1 min-w-0">
      <i [ngClass]="['pi', reportingData.icon]" class="text-base text-[var(--brand-primary)] shrink-0 mt-0.5"></i>
      <div class="min-w-0 flex-1">
        <h3 class="text-base font-semibold text-[var(--on-surface)] m-0 leading-tight">{{ reportingData.title }}</h3>
      </div>
    </div>
    <button pButton type="button" icon="pi pi-info-circle" class="p-button-text p-button-sm" (click)="toggleDescription()"></button>
  </div>

  <div class="flex flex-col gap-3">
    <div class="border border-[var(--border-color)] rounded-lg overflow-hidden">
      <table class="w-full text-xs border-collapse">
        <thead>
          <tr class="bg-[var(--surface-alt)] border-b border-[var(--border-color)]">
            @for (column of reportingData.tableColumns; track column) {
              <th class="px-3 py-2 text-left font-semibold text-[var(--on-surface)] text-xs">{{ column }}</th>
            }
          </tr>
        </thead>
        <tbody>
          @if (reportingData.tableData && reportingData.tableData.length > 0) {
            @for (row of reportingData.tableData.slice(0, 4); track $index) {
              <tr class="border-b border-[var(--border-color)] transition-colors duration-200 hover:bg-[var(--surface-alt)] last:border-b-0">
                @for (column of reportingData.tableColumns; track column) {
                  <td class="px-3 py-2 text-[var(--on-surface-muted)] text-xs">{{ getTableValue(row, column) }}</td>
                }
              </tr>
            }
          } @else {
            <tr>
              <td class="px-3 py-6 text-center text-[var(--on-surface-muted)] text-xs" [attr.colspan]="reportingData.tableColumns.length">
                No hay datos
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if (reportingData.chartType) {
      <div class="flex justify-end mt-2">
        <p-button
          label="Ver GrÃ¡fico"
          icon="pi pi-external-link"
          [outlined]="true"
          size="small"
          class="text-xs"
          (onClick)="openChart()">
        </p-button>
      </div>
    }
  </div>
</p-card>

<!-- Description Modal -->
<p-dialog
  [header]="reportingData.title"
  [(visible)]="descriptionVisible"
  [modal]="true"
  [style]="{ width: '50vw', maxWidth: '600px' }"
  [draggable]="false"
  [resizable]="false">
  <p class="m-0">{{ reportingData.description }}</p>
  @if(reportingData.helpText) {
    <p class="mt-3 text-sm text-[var(--on-surface-muted)]">{{ reportingData.helpText }}</p>
  }
</p-dialog>

<!-- Chart Modal -->
<p-dialog
  [(visible)]="chartVisible"
  [modal]="true"
  [style]="{ width: '70vw', height: '70vh' }"
  [draggable]="false"
  [resizable]="false"
  (onHide)="closeChart()">
  <ng-template pTemplate="header">
    <div class="flex flex-col gap-1">
      <h2 class="text-lg font-semibold">{{ reportingData.title }}</h2>
      <p class="text-sm text-[var(--on-surface-muted)] m-0">{{ reportingData.description }}</p>
    </div>
  </ng-template>

  <div class="h-full w-full flex items-center justify-center">
    @if (hasChartData() && reportingData.chartType) {
      <p-chart [type]="reportingData.chartType" [data]="chartData" [options]="chartOptions" class="w-full h-full"></p-chart>
    } @else {
      <div class="flex items-center justify-center text-sm text-[var(--on-surface-muted)] h-full">
        No hay datos para graficar
      </div>
    }
  </div>
</p-dialog>
