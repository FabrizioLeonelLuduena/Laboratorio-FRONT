<!-- Spinner overlay durante loading -->
@if (loading) {
  <app-spinner
    [overlay]="true"
    label="Enviando correo de recuperación...">
  </app-spinner>
}

<!-- Alert Component -->
@if (showAlert) {
  <app-generic-alert
    [type]="alertType"
    [text]="alertMessage">
  </app-generic-alert>
}

<!-- Recovery form (reuses app-login-form) always rendered; inner content toggles -->
<app-login-form
  [fields]="formFields"
  [usernameKey]="'email'"
  [title]="'Recuperar Contraseña'"
  [headerIcon]="emailSent ? 'pi pi-check-circle' : null"
  [subtitle]="!emailSent ? 'Ingresa tu email y te enviaremos un enlace para restablecer tu contraseña' : '¡Email Enviado!'"
  submitLabel="Enviar enlace de recuperación"
  [backgroundImage]="'laboratory-background.jpg'"
  [showFooter]="true"
  [showForgotLink]="false"
  [genericShowCancel]="false"
  [buttonType]="'custom'"
  [buttonIcon]="'pi pi-envelope'"
  [buttonColor]="'--brand-primary-700'"
  [buttonFullWidth]="true"
  [showInnerForm]="!emailSent"
  (submitLogin)="onSubmit($event)">

<!-- projected success content -->
 @if(emailSent) {
  <div recover-success>
      <p class="success-message">
        Hemos enviado un enlace de recuperación a <strong>{{ submittedEmail }}</strong>
      </p>
      <p class="success-instructions">
        Revisa tu bandeja de entrada y sigue las instrucciones del email para restablecer tu contraseña.
      </p>

      <div class="success-actions">
            <div class="success-actions-row">
              <a routerLink="/login" class="btn-back-link">
                <app-generic-button
                  text="Volver al login"
                  icon="pi pi-arrow-left"
                  type="custom"
                  color="--canvas"
                  customTextColor="--brand-primary-700">
                </app-generic-button>
              </a>

              <app-generic-button
                text="Enviar otro email"
                icon="pi pi-refresh"
                type="custom"
                color="--brand-primary-700"
                (pressed)="onFormCancel()">
              </app-generic-button>
            </div>
      </div>
    </div>
 }
</app-login-form>