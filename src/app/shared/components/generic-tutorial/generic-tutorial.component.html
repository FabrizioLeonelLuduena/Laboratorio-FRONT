@if (isActive()) {
  <div class="tutorial-overlay">
    <!-- Capa oscura de fondo - bloqueada para evitar interacciones -->
    <div class="overlay-background" (click)="onBackgroundClick($event)" (mousedown)="onBackgroundClick($event)"></div>

    <!-- SVG para crear el efecto de "recorte" spotlight -->
    <svg class="spotlight-svg">
      <defs>
        <mask id="spotlight-mask">
          <rect width="100%" height="100%" fill="white"/>
          <rect
            [attr.x]="highlightRect().x"
            [attr.y]="highlightRect().y"
            [attr.width]="highlightRect().width"
            [attr.height]="highlightRect().height"
            [attr.rx]="8"
            fill="black"
          />
        </mask>
      </defs>
      <rect
        width="100%"
        height="100%"
        fill="rgba(0, 0, 0, 0.75)"
        mask="url(#spotlight-mask)"
      />
    </svg>

    <!-- Borde brillante alrededor del elemento resaltado -->
    <div
      class="highlight-border"
      [style.left.px]="highlightRect().x"
      [style.top.px]="highlightRect().y"
      [style.width.px]="highlightRect().width"
      [style.height.px]="highlightRect().height"
    ></div>

    <!-- Contenedor del mensaje -->
    <div
      class="tutorial-message"
      [class]="'position-' + currentStep().position"
      [style.left.px]="messagePosition().x"
      [style.top.px]="messagePosition().y"
    >
      <div class="message-header">
        <h3>{{ currentStep().title }}</h3>
        <button
          class="close-btn"
          (click)="skip()"
          aria-label="Cerrar tutorial"
          title="Saltar tutorial"
        >
          âœ•
        </button>
      </div>

      <p class="message-content">{{ currentStep().message }}</p>

      <div class="message-footer">
        <div class="step-indicator">
          Paso {{ currentStepIndex() + 1 }} de {{ config().steps.length }}
        </div>

        <div class="button-group">
          @if (currentStepIndex() > 0) {
            <button class="btn-secondary" (click)="previous()" title="Volver al paso anterior">
              Anterior
            </button>
          }

          @if (currentStepIndex() < config().steps.length - 1) {
            <button class="btn-primary" (click)="next()" title="Ir al siguiente paso">
              Siguiente
            </button>
          } @else {
            <button class="btn-primary" (click)="complete()" title="Completar tutorial">
              Finalizar
            </button>
          }
        </div>
      </div>
    </div>
  </div>
}
